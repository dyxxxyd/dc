#### session共享
| 方式 | 做法 |
| --- | --- |
| 客户端cookie保存 | 以cookie加密的方式保存在客户端，优点是可以减轻服务器压力，一个session中的两次或者多次请求可以在一个集群的多个服务器上完成，可以避免单点故障。缺点：1. 传递cookie时，http信息头长度限制。2. 需要额外做session信息加密工作。3. 占用额外带宽。4. 用户可以禁用cookie，不是很可靠 |
| 服务期间session同步 | 使用主从服务器架构，当用户在主服务器登录后，通过脚本或守护进程的方式，将session传递到各从服务器，这样用户访问其他服务器时，就可以读取到session信息；缺点：1. 速度慢、不稳定。2. session传递是主从单向，如果主服务器挂了，其他服务器无法获取session。3. 同时对海量访问或密集型访问，可能会出现不同步或重复登录的情况 |
| 使用集群管理session | 提供一个集群保存session共享信息，其他应用把自己的session信息保存到session集群服务器组，当应用系统需要session信息时直接从集群服务器读取。目前大多数都使用Memcache来对session进行存储。优点：1. 开发者不哟个考虑session共享问题，专注于程序开发，像正常使用session就可以。2. 不用开始编写代码，只需要对服务器进行配置即可使用。缺点：如果想改变session策略，必须重新部署每个服务器的servlet容器 |
| 把session持久化到数据库 | 将session信息存入数据库中，其他应用可以从数据库中查出session信息。缺点：1. session的并发读写在数据库中完成，对MySQL的性能要求较高。2. 需要额外实现session淘汰逻辑，即定时从数据库表中更新和删除session信息，增加了工作量 |
| NoSQL | 把session持久化到Redis、MongoDB中很好的解决了MySQL数据库性能的问题 |

#### 从用户在浏览器输入网址并回车，到看到完整的页面，中间经历的过程  
从用户电脑找到最近的DNS服务，然后解析到对应的IP，双方建立HTTP连接，发送请求信息，服务器拿到请求信息准备响应信息，中间要经过Nginx转发到FastCGI（PHP-FPM），然后PHP开始解析框架，解析请求头，找到对应API，该查数据库查数据库，该组装HTML组装HTML，然后重新返回给用户，用户拿到返回数据，浏览器开始渲染页面，JS开始加载。

#### HTTP工作流程

地址解析->封装HTTP请求数据包->浏览器获取主机IP并建立TCP连接->TCP连接建立后发送HTTP请求->服务端接收到请求并做出响应->服务器断开TCP连接

#### Socket的工作流程

Socket：网络套接字，是一种操作系统提供的进程间通信机制
工作流程：
1. 服务端先用socket函数建立一个套接字，并调用listen函数监听IP和端口，等待客户端的连接
2. 客户端用socket函数建立一个套接字，设定远程IP和端口，并调用connect函数
3. 服务端用accept函数接受远程计算机的连接，建立与客户端的通信
4. 完成通信使用close关闭socket连接

#### TCP和UDP

| TCP | 面向连接，可靠、基于字节流的传输层通信协议。首部开销20字节，全双工的可靠逻辑通信信道。点到点连接，面向字节流 |
| --- | --- |
| UDP | 首部开销8字节。无连接的传输协议(发送数据前不需要建立连接)，提供面向事务的简单不可靠的信息传递。没有拥塞机制，网络出现拥堵不会是源主机的发送效率降低。支持一对一、多对一、多对多的交互通信，面向报文 |
注：UPD的可靠连接实现方式：UDT（基于UDP的数据传输协议，UDT建于UDP之上，并引入新的拥塞控制和数据可靠性控制机制）

#### 长连接和短连接

| 短连接 | 连接建立->数据传输->关闭连接。短连接对于服务器来说管理较为简单，存在的连接都是有用的，不需要额外控制手段 |
| --- | --- |
| 长连接 | 连接建立->数据传输->（保持连接）->数据传输->关闭连接。可以省去较多的TCP建立和关闭操作，减少资源浪费，节省时间，对于比较频繁的请求资源的客户端比较适用于长连接 |

Q：为什么TCP连接握手是三次，挥手是四次
A：在TCP连接中，服务端SYN和ACK向客户端发送是一次性的，而在断开连接的过程中，B端向A端发送的ACK和FIN是分两次发送的。因为在B端接收到A端的FIN后，B端可能还有数据要传输，所以先发送ACK，等B端处理完自己的事情后就可以发送FIN断开连接了。
注：一般都是客户端通知服务端数据发送完毕断开连接，如果客户端发完FIN服务端没有回复就会重试，直到超时断开。服务端也是一样，超过时间，服务端就断了。

#### 什么是Socket，工作流程是怎样的

网络套接字，是一种操作系统提供的进程间通信机制。
工作流程：
1. 服务端先用socket函数建立一个套接字，并调用listen函数，监听端口和IP，等待客户端的连接
2. 客户端用socket函数建立一个套接字，设定远程IP和端口，并调用connect函数
3. 服务端用accept函数接受远程计算机的连接，建立与客户端的通信
4. 完成通信用使用close关闭socket连接

#### HTTP1.1与WebSocket的区别

1. HTTP是一个单链接，只能做单向通讯，WebSocket是一个持久连接，可用作双向通讯。
2. WebSocket是基于HTTP来建立连接的，建立连接后真正的数据传输是不需要HTTP参与的。
3. WebSocket的请求头部与HTTP请求头部不同。
4. WebSocket传输的是二进制流，HTTP是明文字符串传输

#### 什么是CGI？什么是FastCGI？PHP-FPM，FastCGI，Nginx之间的关系

CGI，通用网关接口，用于web服务器和应用程序间的交互，定义输入输出规范，用户的请求通过web服务器转发给FastCGI进程，FastCGI再调用应用程序处理。如PHP解析器，程序处理HTML返回给FastCGI，FastCGI返回给Nginx进行输出。关系：假设Web服务器是Nginx，应用程序是PHP，而PHP-FPM是管理FastCGI的。FastCGI用来提高CGI程序性能，启动一个master，再启动多个worker，不需要每次解析php.ini。而PHP-FPM实现了FastCGI协议，是FastCGI的进程管理器，支持平滑启动，可以启动的时候预先生产多个进程。
